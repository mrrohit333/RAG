# RAG Assistant — Document-aware Chatbot

Small RAG (Retrieval-Augmented Generation) project: a FastAPI backend that ingests user documents, builds per-user FAISS indices and serves a Next.js frontend chat UI.

Quick links
- Backend entry: [`main`](backend/main.py) — [backend/main.py](backend/main.py)
  - Endpoints: [`main.upload_file`](backend/main.py), [`main.ask_question`](backend/main.py), [`main.ask_question_json`](backend/main.py), [`main.list_user_docs`](backend/main.py), [`main.delete_doc`](backend/main.py), [`main.register`](backend/main.py), [`main.login`](backend/main.py)
- Retrieval & indexing pipeline: [`rag_pipeline`](backend/rag_pipeline.py) — [backend/rag_pipeline.py](backend/rag_pipeline.py)
  - Key functions: [`rag_pipeline.add_new_document`](backend/rag_pipeline.py), [`rag_pipeline.get_response_stream`](backend/rag_pipeline.py), [`rag_pipeline.chunk_file`](backend/rag_pipeline.py), [`rag_pipeline.get_user_dirs`](backend/rag_pipeline.py), [`rag_pipeline.clear_user_index`](backend/rag_pipeline.py), [`rag_pipeline.load_user_index`](backend/rag_pipeline.py), [`rag_pipeline.delete_user_document`](backend/rag_pipeline.py)
- Frontend chat UI: [`ChatInterface`](frontend/components/chat-interface.tsx) — [frontend/components/chat-interface.tsx](frontend/components/chat-interface.tsx)
- Package manifests & deps:
  - Backend requirements: [backend/requirements.txt](backend/requirements.txt)
  - Frontend: [frontend/package.json](frontend/package.json) and Next config [frontend/next.config.mjs](frontend/next.config.mjs)

Repository layout
- backend/ — FastAPI server, ingestion + FAISS pipeline (see [backend/rag_pipeline.py](backend/rag_pipeline.py))
  - main server: [backend/main.py](backend/main.py)
  - DB + models: [backend/database.py](backend/database.py), [backend/models.py](backend/models.py)
  - per-user data: stored under backend/data/<user_id>/ (FAISS files like `faiss.index`, chunk cache `chunks.pkl`, and `metadata.json`) — e.g. [backend/data/5/metadata.json](backend/data/5/metadata.json), [backend/data/1/metadata.json](backend/data/1/metadata.json)
- frontend/ — Next.js app (React) with chat UI components (see [frontend/components/chat-interface.tsx](frontend/components/chat-interface.tsx))
- vector_store/ — optional exported vector data (gitignored)

Supported document formats
- See the chunking logic in [`rag_pipeline.chunk_file`](backend/rag_pipeline.py) — supported: PDF, TXT, CSV, TSV, XLSX, DOCX, PPTX.

Setup & run

1. Backend (Python)
- Create venv and install:
  - python >= 3.9
  - pip install -r backend/requirements.txt
  - File: [backend/requirements.txt](backend/requirements.txt)
- Start server (development):
  - uvicorn main:app --reload --port 8000
  - The backend exposes upload and chat endpoints in [backend/main.py](backend/main.py).

2. Frontend (Next.js)
- Node >= 18
- cd frontend
- npm install (or pnpm / yarn)
- npm run dev
- Frontend login/register/chat pages live under [frontend/app](frontend/app). Main chat component: [`ChatInterface`](frontend/components/chat-interface.tsx).

How to use
- Register / login via frontend ([frontend/app/register/page.tsx](frontend/app/register/page.tsx), [frontend/app/login/page.tsx](frontend/app/login/page.tsx)).
- Upload a document from the chat UI — the frontend posts to [`main.upload_file`](backend/main.py) which invokes [`rag_pipeline.add_new_document`](backend/rag_pipeline.py).
- Ask questions: frontend posts to [`main.ask_question`](backend/main.py) which streams answers generated by [`rag_pipeline.get_response_stream`](backend/rag_pipeline.py).
- Manage user documents: list via [`main.list_user_docs`](backend/main.py); delete via [`main.delete_doc`](backend/main.py) -> triggers [`rag_pipeline.delete_user_document`](backend/rag_pipeline.py).

Data & indices
- Per-user directory: created by [`rag_pipeline.get_user_dirs`](backend/rag_pipeline.py)
  - Files: `faiss.index` (FAISS binary), `chunks.pkl`, `metadata.json` (upload records)
  - Example metadata: [backend/data/5/metadata.json](backend/data/5/metadata.json)
- To clear or rebuild indices use [`rag_pipeline.clear_user_index`](backend/rag_pipeline.py) and the add/rebuild helpers in [backend/rag_pipeline.py](backend/rag_pipeline.py).

Configuration
- Embedding model and vector dimension set in [`rag_pipeline`](backend/rag_pipeline.py): `MODEL_NAME`, `DIM`, `RELEVANCE_THRESHOLD`.
- FastAPI CORS and port configured in [backend/main.py](backend/main.py).
- Frontend dev scripts in [frontend/package.json](frontend/package.json).

Notes & troubleshooting
- FAISS index files are binary (e.g. [backend/data/5/faiss.index](backend/data/5/faiss.index)). They are ignored by .gitignore — see [.gitignore](.gitignore) and [frontend/.gitignore](frontend/.gitignore).
- If uploads fail, ensure backend is running and `backend/data/<user_id>/` is writable.
- If indexing fails, inspect backend logs where [`rag_pipeline.chunk_file`](backend/rag_pipeline.py) prints parsing messages.
- To force-clear user vectors, call [`rag_pipeline.clear_user_index`](backend/rag_pipeline.py) or remove `faiss.index` and `chunks.pkl` under the user data folder.

Developer pointers
- UI component patterns follow the design system under `frontend/components/ui/` (e.g. avatar, toast, tabs).
- Chat streaming is implemented in [`rag_pipeline.get_response_stream`](backend/rag_pipeline.py) and consumed by [`ChatInterface`](frontend/components/chat-interface.tsx).
- DB models and registration/login flows are in [backend/models.py](backend/models.py) and [backend/main.py](backend/main.py).

Contact
- Use repository issues or open a terminal and run the backend/frontend locally to inspect logs and iterate quickly.

License
- No license file provided. Add LICENSE if you intend to open-source.
